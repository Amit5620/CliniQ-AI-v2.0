{% extends "base.html" %}


{% block content %}
    
<!-- Include Bootstrap 5 and FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

<style>
      /* prediction form css start*/
  .prediction-main {
    background: linear-gradient(135deg, #d0e8ff, #f9fcff);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    padding: 2rem 1rem;
    color: #1a1a1a;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    max-width: 900px;
    margin: 0 auto;
  }

  .card {
    background: rgba(255 255 255 / 0.9);
    border-radius: 28px;
    box-shadow:
      0 12px 40px rgba(0 123 255 / 0.2),
      inset 0 0 60px rgba(0 123 255 / 0.12);
    padding: 3rem 2.5rem 2.5rem;
    border: none;
    transition: box-shadow 0.3s ease;
  }
  .card:hover {
    box-shadow:
      0 18px 60px rgba(0 123 255 / 0.3),
      inset 0 0 80px rgba(0 123 255 / 0.15);
  }

  .card-header {
    background: linear-gradient(90deg, #0077ff, #3399ff);
    border-radius: 20px 20px 0 0;
    color: white;
    font-weight: 700;
    font-size: 1.6rem;
    padding: 1.2rem 2rem;
    box-shadow: 0 6px 20px rgba(0 119 255 / 0.45);
    user-select: none;
  }

  h1.page-title {
    font-weight: 800;
    font-size: 2.8rem;
    color: #004a99;
    margin-bottom: 2rem;
    user-select: none;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    letter-spacing: 0.03em;
  }
  h1.page-title i {
    color: #0077ff;
    font-size: 3rem;
    animation: heartbeat 1.5s infinite;
  }
  @keyframes heartbeat {
    0%, 100% { transform: scale(1); }
    25%, 75% { transform: scale(1.15); }
    50% { transform: scale(1.3); }
  }

  /* Floating labels with underline animation */
  .form-floating > label {
    color: #6c757d;
    transition: all 0.3s ease;
    pointer-events: none;
    letter-spacing: 0.02em;
  }
  .form-floating > input,
  .form-floating > select,
  .form-floating > textarea {
    background: transparent;
    border: none;
    border-bottom: 2.5px solid #cce4ff;
    border-radius: 0;
    color: #1a1a1a;
    padding: 1.25rem 0.25rem 0.5rem 0.25rem;
    font-size: 1.1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: none;
  }
  .form-floating > input:hover,
  .form-floating > select:hover,
  .form-floating > textarea:hover {
    border-bottom-color: #80b3ff;
  }
  .form-floating > input:focus,
  .form-floating > select:focus,
  .form-floating > textarea:focus {
    border-bottom-color: #0077ff;
    box-shadow: 0 2px 8px #3399ff88;
    outline: none;
    color: #004a99;
  }
  .form-floating > input:focus + label,
  .form-floating > select:focus + label,
  .form-floating > textarea:focus + label,
  .form-floating > input:not(:placeholder-shown) + label,
  .form-floating > select:not(:placeholder-shown) + label,
  .form-floating > textarea:not(:placeholder-shown) + label {
    transform: translateY(-1.6rem);
    font-size: 0.85rem;
    color: #0077ff;
    font-weight: 600;
  }
  textarea.form-control {
    min-height: 110px;
    resize: vertical;
  }

  /* Upload box */
  .upload-box {
    border: 3.5px dashed #3399ff;
    border-radius: 24px;
    padding: 65px 20px;
    background: linear-gradient(145deg, #e6f4ff, #cce7ff);
    cursor: pointer;
    text-align: center;
    transition: all 0.35s ease;
    position: relative;
    user-select: none;
    box-shadow: 0 0 18px rgba(51, 153, 255, 0.25);
  }
  .upload-box.dragover {
    background: #cce7ff;
    border-color: #0077ff;
    box-shadow: 0 0 38px #3399ffaa;
    transform: scale(1.07);
  }
  .upload-box svg {
    width: 75px;
    height: 75px;
    fill: #0077ff;
    margin-bottom: 22px;
    animation: pulse 2.5s infinite ease-in-out;
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.9; }
    50% { transform: scale(1.15); opacity: 1; }
  }
  .upload-box p {
    font-weight: 700;
    color: #004a99;
    margin: 0;
    font-size: 1.25rem;
    letter-spacing: 0.02em;
  }
  .upload-box p.subtext {
    font-weight: 400;
    font-size: 1rem;
    color: #2a2a2a;
    margin-top: 6px;
  }
  input[type="file"] {
    display: none;
  }

  /* Preview */
  .preview {
    margin-top: 28px;
    text-align: center;
    position: relative;
  }
  .preview img {
    max-width: 280px;
    max-height: 280px;
    border-radius: 20px;
    border: 5px solid #3399ff;
    padding: 6px;
    background: #fff;
    box-shadow: 0 10px 30px rgba(0 102 204 / 0.3);
    transition: transform 0.35s ease, box-shadow 0.35s ease;
  }
  .preview img:hover {
    transform: scale(1.08);
    box-shadow: 0 14px 40px rgba(0 119 255 / 0.45);
  }
  .clear-btn {
    position: absolute;
    top: -14px;
    right: -14px;
    background: #ff4d4d;
    border: none;
    border-radius: 50%;
    width: 34px;
    height: 34px;
    color: white;
    font-weight: 700;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 4px 14px rgba(255 77 77 / 0.55);
    transition: background 0.3s ease;
  }
  .clear-btn:hover {
    background: #e60000;
  }

  /* Submit button */
  button.btn-primary {
    font-size: 1.35rem;
    font-weight: 700;
    padding: 0.85rem 3rem;
    border-radius: 30px;
    box-shadow: 0 8px 28px rgba(0 119 255 / 0.4);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button.btn-primary:hover {
    background-color: #005fcc;
    box-shadow: 0 12px 40px rgba(0 95 204 / 0.6);
  }

  /* Responsive */
  @media (max-width: 767px) {
    .card {
      padding: 2.5rem 1.8rem 2rem;
    }
    .upload-box {
      padding: 55px 15px;
    }
    .preview img {
      max-width: 90vw;
      max-height: 90vw;
    }
  }
        /* prediction form css end */
</style>





<div class="container-fluid" style="padding-top: 80px;">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 sidebar animate-slide-in">
            <div class="position-sticky">
                <div class="text-center py-4">
                    <i class="fas fa-user-circle text-white" style="font-size: 4rem;"></i>
                    <h5 class="text-white mt-2">{{ current_user.full_name }}</h5>
                    <p class="text-white-50">Patient</p>
                </div>
                
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('user_dashboard') }}">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('ecg_predict') }}">
                            <i class="fas fa-heartbeat me-2"></i>ECG Analysis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('user_report_data') }}">
                            <i class="fas fa-file-medical me-2"></i>My Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('user_appointments') }}">
                            <i class="fas fa-calendar-check me-2"></i>Appointments
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('book_appointment') }}">
                            <i class="fas fa-plus-circle me-2"></i>Book Appointment
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

<main class="prediction-main col-md-9 ms-sm-auto col-lg-10 px-md-4 animate-slide-in" role="main">
  <h1 class="page-title" aria-label="ECG Analysis">
    <i class="fas fa-heartbeat" aria-hidden="true"></i> ECG Analysis
  </h1>

  <div class="card shadow-sm">
    <div class="card-header">Upload ECG Image for Analysis</div>
    <form method="POST" action="{{ url_for('ecg_predict') }}" enctype="multipart/form-data" id="ecg-form" novalidate>
      <div class="row g-4">
        <div class="col-md-6">
          <div class="form-floating">
            <input type="text" class="form-control" id="patient_name" name="patient_name" placeholder="Patient Name" required />
            <label for="patient_name">Patient Name</label>
          </div>

          <div class="form-floating mt-4">
            <input type="number" class="form-control" id="patient_age" name="patient_age" min="1" max="120" placeholder="Patient Age" required />
            <label for="patient_age">Patient Age</label>
          </div>

          <div class="form-floating mt-4">
            <select class="form-select" id="patient_gender" name="patient_gender" required>
              <option value="" disabled selected></option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
            <label for="patient_gender">Patient Gender</label>
          </div>

          <div class="form-floating mt-4">
            <input type="text" class="form-control" id="patient_id" name="patient_id" placeholder="Patient ID Generate Automatically by the system" value="{{ patient_id }}" readonly />
            <label for="patient_id">Patient ID</label>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-floating">
            <input type="text" class="form-control" id="doctor_name" name="doctor_name" placeholder="Referring Doctor" required />
            <label for="doctor_name">Referring Doctor</label>
          </div>

          <div class="form-floating mt-4">
            <select class="form-select" id="doctor_type" name="doctor_type" required>
              <option value="" disabled selected></option>
              <option>Cardiologist</option>
              <option>Neurologist</option>
              <option>Radiologist</option>
              <option>Pulmonologist</option>
              <option>Oncologist</option>
              <option>General Physician</option>
              <option>Emergency Medicine</option>
              <option>Internal Medicine</option>
              <option>Pediatrician</option>
              <option>Dermatologist</option>
              <option>Orthopedic</option>
              <option>Psychiatrist</option>
              <option>Gynecologist</option>
              <option>ENT Specialist</option>
            </select>
            <label for="doctor_type">Doctor Specialty</label>
          </div>

          <div class="form-floating mt-4">
            <textarea class="form-control" id="patient_symptoms" name="patient_symptoms" placeholder="Patient Symptoms" required></textarea>
            <label for="patient_symptoms">Patient Symptoms</label>
          </div>

          <div class="mt-5">
            <label for="file" class="form-label mb-2" style="color:#004a99; font-weight:700; font-size:1.15rem;">ECG Image</label>
            <label for="file" class="upload-box" id="uploadBox" tabindex="0" aria-label="Upload ECG image by clicking or drag and drop">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
                <path d="M44 12H20a4 4 0 0 0-4 4v32a4 4 0 0 0 4 4h24a4 4 0 0 0 4-4V16a4 4 0 0 0-4-4Zm-2 34H22V18h20Zm-10-6a6 6 0 1 1 0-12 6 6 0 0 1 0 12Z"/>
              </svg>
              <p><strong>Click or Drag & Drop</strong></p>
              <p class="subtext">Upload ECG Image (JPG, PNG)</p>
              <input type="file" id="file" name="file" accept="image/*" required />
            </label>
            <div class="preview" id="preview" aria-live="polite" aria-atomic="true"></div>
          </div>
        </div>
      </div>

      <div class="text-center mt-5">
        <button type="submit" class="btn btn-primary btn-lg px-5" aria-label="Analyze ECG">
          <i class="fas fa-upload me-2"></i>Analyze ECG
        </button>
      </div>
    </form>
  </div>
</main>

    </div>
</div>

<!-- Loading Spinner -->
<div id="loading-spinner" class="position-fixed top-50 start-50 translate-middle" style="display: none; z-index: 1050;">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Analyzing your ECG image, please wait...</p>
    </div>
</div>

<div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50" style="display: none; z-index: 1040;"></div>
{% endblock %}

{% block extra_js %}
<script>
    const uploadBox = document.getElementById('uploadBox');
  const fileInput = document.getElementById('file');
  const preview = document.getElementById('preview');

  uploadBox.addEventListener('dragover', e => {
    e.preventDefault();
    uploadBox.classList.add('dragover');
  });
  uploadBox.addEventListener('dragleave', () => {
    uploadBox.classList.remove('dragover');
  });
  uploadBox.addEventListener('drop', e => {
    e.preventDefault();
    uploadBox.classList.remove('dragover');
    if (e.dataTransfer.files.length) {
      fileInput.files = e.dataTransfer.files;
      previewImage(fileInput.files[0]);
    }
  });

  uploadBox.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      fileInput.click();
    }
  });

  fileInput.addEventListener('change', () => {
    if (fileInput.files.length) previewImage(fileInput.files[0]);
  });

  function previewImage(file) {
    preview.innerHTML = '';
    if (!file) return;

    if (file.size > 20 * 1024 * 1024) {
      alert('File size exceeds 20MB limit.');
      fileInput.value = '';
      return;
    }

    if (!file.type.startsWith('image/')) {
      alert('Unsupported file format. Please upload an image.');
      fileInput.value = '';
      return;
    }

    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.alt = 'Preview of uploaded ECG image';
    preview.appendChild(img);

    const clearBtn = document.createElement('button');
    clearBtn.className = 'clear-btn';
    clearBtn.setAttribute('aria-label', 'Clear uploaded file');
    clearBtn.innerHTML = '&times;';
    clearBtn.onclick = () => {
      fileInput.value = '';
      preview.innerHTML = '';
      fileInput.focus();
    };
    preview.appendChild(clearBtn);
  }

    document.getElementById('ecg-form').addEventListener('submit', function() {
        // Show the loading spinner and overlay
        document.getElementById('loading-spinner').style.display = 'block';
        document.getElementById('loading-overlay').style.display = 'block';
        
        // Disable the submit button to prevent multiple submissions
        const submitButton = this.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
    });
</script>
{% endblock %}
